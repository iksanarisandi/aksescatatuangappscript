<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Aplikasi Catatan Keuangan - Kelola keuangan Anda dengan mudah">
  <meta name="keywords" content="catatan keuangan, aplikasi keuangan, iksan arisandi">
  <meta name="author" content="Iksan Arisandi">
  <title>Aplikasi Catatan Keuangan</title>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    }

    /* Loading Screen */
    #loading {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease-out;
    }

    #loading.hide {
      opacity: 0;
      pointer-events: none;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .loading-text {
      color: white;
      font-size: 16px;
      margin-top: 20px;
    }

    /* Iframe Container */
    #iframe-container {
      width: 100%;
      height: 100%;
      position: relative;
      opacity: 0;
      transition: opacity 0.5s ease-in;
    }

    #iframe-container.show {
      opacity: 1;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }

    /* Error Message */
    .error-message {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
      text-align: center;
      max-width: 90%;
      z-index: 10000;
    }

    .error-message.show {
      display: block;
    }

    .error-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    .error-title {
      font-size: 20px;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 10px;
    }

    .error-text {
      font-size: 14px;
      color: #718096;
      margin-bottom: 20px;
    }

    .retry-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .retry-btn:hover {
      transform: translateY(-2px);
    }

    .retry-btn:active {
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loading">
    <div class="spinner"></div>
    <div class="loading-text">Memuat aplikasi...</div>
  </div>

  <!-- Error Message -->
  <div id="error-message" class="error-message">
    <div class="error-icon">⚠️</div>
    <div class="error-title">Gagal Memuat Aplikasi</div>
    <div class="error-text">Terjadi kesalahan saat memuat aplikasi. Silakan coba lagi.</div>
    <button class="retry-btn" onclick="location.reload()">Muat Ulang</button>
  </div>

  <!-- Iframe Container -->
  <div id="iframe-container">
    <iframe 
      id="app-iframe"
      src="https://script.google.com/macros/s/AKfycbxsW4E-qyXMkdyhgLEmR5umEHVOp-K5wHpec5DJSF87uU3YjU0xFJINHTbPeubdZLmZpQ/exec"
      title="Aplikasi Catatan Keuangan"
      allow="clipboard-write; clipboard-read"
      loading="eager"
      sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation"
    ></iframe>
  </div>

  <script>
    // KONFIGURASI - Ganti URL ini dengan URL Apps Script Anda
    const APPSCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxsW4E-qyXMkdyhgLEmR5umEHVOp-K5wHpec5DJSF87uU3YjU0xFJINHTbPeubdZLmZpQ/exec';

    // Elements
    const loading = document.getElementById('loading');
    const iframeContainer = document.getElementById('iframe-container');
    const appIframe = document.getElementById('app-iframe');
    const errorMessage = document.getElementById('error-message');

    // Set iframe source
    appIframe.src = APPSCRIPT_URL;

    // Timeout untuk loading (max 10 detik)
    let loadingTimeout;
    let loadingMinTimeout;

    function hideLoading() {
      clearTimeout(loadingTimeout);
      clearTimeout(loadingMinTimeout);
      loading.classList.add('hide');
      setTimeout(() => {
        iframeContainer.classList.add('show');
      }, 300);
    }

    function showError() {
      clearTimeout(loadingTimeout);
      loading.classList.add('hide');
      errorMessage.classList.add('show');
    }

    // Event listener untuk iframe load
    appIframe.addEventListener('load', function() {
      hideLoading();
    });

    // Event listener untuk iframe error
    appIframe.addEventListener('error', function() {
      showError();
    });

    // Minimum loading time (supaya tidak terlalu cepat/flickering)
    loadingMinTimeout = setTimeout(function() {
      hideLoading();
    }, 800); // Loading minimal 0.8 detik, bisa diubah (500-1500)

    // Timeout jika loading terlalu lama (10 detik)
    loadingTimeout = setTimeout(function() {
      if (!iframeContainer.classList.contains('show')) {
        // Cek apakah iframe sudah load
        try {
          if (appIframe.contentWindow) {
            hideLoading(); // Berhasil load tapi lambat
          } else {
            showError(); // Gagal load
          }
        } catch (e) {
          hideLoading(); // Cross-origin, anggap berhasil
        }
      }
    }, 10000);

    // Prevent right-click (optional, untuk proteksi)
    // Uncomment jika ingin disable right-click
    /*
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });
    */

    // Komunikasi dengan iframe (optional)
    window.addEventListener('message', function(event) {
      // Validasi origin untuk keamanan
      // if (event.origin !== 'https://script.google.com') return;
      
      // Handle message dari iframe jika diperlukan
      console.log('Message from iframe:', event.data);
    });

    // Handle visibility change
    document.addEventListener('visibilitychange', function() {
      if (document.hidden) {
        console.log('Page hidden');
      } else {
        console.log('Page visible');
      }
    });

    // Detect mobile device
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    if (isMobile) {
      // Add mobile-specific class if needed
      document.body.classList.add('mobile');
    }
  </script>
</body>
</html>
